function init(){var t=new App;t.run()}var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},UIButton=function(t){function e(e,i,s,h,n){void 0===i&&(i=28),void 0===s&&(s=100),void 0===h&&(h=40),void 0===n&&(n=!0),t.call(this),this.normalColor="#afafaf",this.rollOverColor="#7f7f7f",this.fontColor=0,this.bold=!1,this.underline=!1,this.rollOver=!1,this.text=e,this.fontSize=i,this.buttonWidth=s,this.buttonHeight=h,this.centerAlign=n,this.frame=new createjs.Shape,this.addChild(this.frame),this.captionText=new createjs.Text,this.addChild(this.captionText),this.redraw();var a=this;this.addEventListener("mousedown",function(){a.rollOver=!0,a.redraw(!1)}),this.addEventListener("pressup",function(){a.rollOver=!1,a.redraw(!1)}),this.addEventListener("rollover",function(){a.rollOver=!0,a.redraw(!1)}),this.addEventListener("rollout",function(){a.rollOver=!1,a.redraw(!1)})}return __extends(e,t),e.prototype.redraw=function(t){void 0===t&&(t=!0),this.frame.graphics.clear(),this.frame.graphics.beginFill(this.rollOver?this.rollOverColor:this.normalColor).drawRoundRect(0,0,this.buttonWidth,this.buttonHeight,4),t&&(this.captionText.font=(this.bold?"bold":"")+this.fontSize+"px Arial",this.captionText.text=this.text,this.centerAlign?this.captionText.x=this.buttonWidth/2-this.captionText.getMeasuredWidth()/2:this.captionText.x=this.fontSize/2,this.captionText.y=this.buttonHeight/2-this.captionText.getMeasuredHeight()/2)},e}(createjs.Container),UICheckBox=function(t){function e(e,i,s,h){void 0===i&&(i=28),void 0===s&&(s=100),void 0===h&&(h=40),t.call(this),this.normalColor="#afafaf",this.rollOverColor="#7f7f7f",this.fontColor=0,this.bold=!1,this.underline=!1,this.rollOver=!1,this.mChecked=!1,this.text=e,this.fontSize=i,this.buttonWidth=s,this.buttonHeight=h,this.frame=new createjs.Shape,this.addChild(this.frame),this.captionText=new createjs.Text,this.addChild(this.captionText),this.checkShape=new createjs.Shape,this.addChild(this.checkShape),this.redraw();var n=this;this.addEventListener("click",function(){n.checked=!n.checked}),this.addEventListener("mousedown",function(){n.rollOver=!0,n.redraw(!1)}),this.addEventListener("pressup",function(){n.rollOver=!1,n.redraw(!1)}),this.addEventListener("rollover",function(){n.rollOver=!0,n.redraw(!1)}),this.addEventListener("rollout",function(){n.rollOver=!1,n.redraw(!1)})}return __extends(e,t),e.prototype.redraw=function(t){void 0===t&&(t=!0),t&&(this.captionText.font=(this.bold?"bold":"")+this.fontSize+"px Arial",this.captionText.text=this.text,this.captionText.x=this.buttonWidth/2-this.captionText.getMeasuredWidth()/2+this.fontSize/2,this.captionText.y=this.buttonHeight/2-this.captionText.getMeasuredHeight()/2),this.frame.graphics.clear(),this.frame.graphics.beginFill(this.rollOver?this.rollOverColor:this.normalColor),this.frame.graphics.drawRoundRect(0,0,this.buttonWidth,this.buttonHeight,4),this.frame.graphics.beginFill("#dfdfdf"),this.frame.graphics.drawRoundRect(this.fontSize/2,(this.buttonHeight-this.captionText.getMeasuredHeight())/2,this.captionText.getMeasuredHeight(),this.captionText.getMeasuredHeight(),4);var e=19.2,i=18.3;this.checkShape.graphics.clear(),this.checkShape.scaleX=this.checkShape.scaleY=1,this.checkShape.graphics.beginFill("#000000"),this.checkShape.graphics.moveTo(4.77,18.29),this.checkShape.graphics.curveTo(4.67,18.29,4.41,17.98),this.checkShape.graphics.curveTo(4.15,17.67,3.79,17.13),this.checkShape.graphics.curveTo(3.44,16.6,3.01,15.88),this.checkShape.graphics.curveTo(2.58,15.16,2.14,14.35),this.checkShape.graphics.lineTo(0,10.41),this.checkShape.graphics.lineTo(.55,9.86),this.checkShape.graphics.curveTo(.67,9.74,.87,9.64),this.checkShape.graphics.curveTo(1.07,9.54,1.32,9.47),this.checkShape.graphics.curveTo(1.56,9.39,1.84,9.35),this.checkShape.graphics.curveTo(2.11,9.31,2.37,9.31),this.checkShape.graphics.lineTo(3.64,9.31),this.checkShape.graphics.lineTo(4.28,11.31),this.checkShape.graphics.lineTo(4.91,13.32),this.checkShape.graphics.lineTo(9.98,7.77),this.checkShape.graphics.curveTo(11.02,6.63,12.11,5.53),this.checkShape.graphics.curveTo(13.19,4.44,14.17,3.53),this.checkShape.graphics.curveTo(15.14,2.63,15.92,1.99),this.checkShape.graphics.curveTo(16.7,1.35,17.13,1.12),this.checkShape.graphics.lineTo(19.21,0),this.checkShape.graphics.lineTo(15,4.78),this.checkShape.graphics.curveTo(14.14,5.77,13.15,6.98),this.checkShape.graphics.curveTo(12.17,8.2,11.22,9.44),this.checkShape.graphics.curveTo(10.27,10.69,9.44,11.86),this.checkShape.graphics.curveTo(8.6,13.03,8.03,13.93),this.checkShape.graphics.curveTo(7.47,14.83,6.92,15.63),this.checkShape.graphics.curveTo(6.38,16.42,5.94,17.02),this.checkShape.graphics.curveTo(5.5,17.61,5.19,17.95),this.checkShape.graphics.curveTo(4.88,18.3,4.77,18.29),this.checkShape.graphics.lineTo(4.774679999999989,18.294990000000098),this.checkShape.graphics.endFill(),this.checkShape.scaleX=this.checkShape.scaleY=(this.fontSize-this.fontSize/7)/e,this.checkShape.x=this.fontSize/2+this.captionText.getMeasuredHeight()/2-e*this.checkShape.scaleX/2,this.checkShape.y=(this.buttonHeight-this.captionText.getMeasuredHeight())/2+this.captionText.getMeasuredHeight()/2-i*this.checkShape.scaleY/2,this.checkShape.visible=this.checked},Object.defineProperty(e.prototype,"checked",{get:function(){return this.mChecked},set:function(t){this.mChecked=t,this.checkShape.visible=this.checked},enumerable:!0,configurable:!0}),e}(createjs.Container),QuestionBoard=function(t){function e(e){t.call(this),this.easingMethod=createjs.Ease.elasticOut;var i=new Array;if(0==e.type)i.push("True","False"),this.correctIndex="true"==e.answer?0:1;else for(var s=0,h=e.option;s<h.length;s++){var n=h[s];n.index.toLowerCase()==e.answer.toLowerCase()&&(this.correctIndex=i.length),i.push(n.index.toUpperCase()+") "+n.value)}this.questionText=new createjs.Text,this.questionText.font="bold 32px Arial",this.questionText.lineWidth=580,this.questionText.text=e.question,this.questionText.x=30,this.questionText.y=60,this.addChild(this.questionText),this.options=new Array;for(var a=0;a<i.length;++a){var r=new UIButton("",32,5,5,!1);if(r.text=i[a],r.captionText.lineWidth=520,r.captionText.text=r.text,r.buttonWidth=540,r.buttonHeight=r.captionText.getMeasuredHeight()+20,r.redraw(),r.x=50,0==a)r.y=this.questionText.y+this.questionText.getMeasuredHeight()+30;else{var o=this.options[a-1];r.y=o.y+o.buttonHeight+20}var c=this;r.addEventListener("click",function(t){var e=t.currentTarget,i=e==c.options[c.correctIndex],s=new createjs.Shape;i?s.graphics.beginFill("#00ff00"):s.graphics.beginFill("#ff0000"),s.graphics.drawRoundRect(0,0,e.buttonWidth,e.buttonHeight,4),e.addChildAt(s,e.numChildren-1),i?(s.alpha=0,createjs.Tween.get(s).to({alpha:1},200,createjs.Ease.cubicOut)):(s.alpha=0,createjs.Tween.get(s).to({alpha:1},100).to({alpha:0},100).to({alpha:1},100).to({alpha:0},100).to({alpha:1},100).to({alpha:0},100).to({alpha:1},100).to({alpha:0},100).to({alpha:1},100).to({alpha:0},100).call(s.parent.removeChild,[s],s.parent))}),this.addChild(r),this.options.push(r)}var d=this.options[this.options.length-1].y+this.options[this.options.length-1].buttonHeight;if(d>480){for(var p=new createjs.Container;this.numChildren;)p.addChild(this.getChildAt(0));this.addChild(p);var l=480/d;p.scaleX=p.scaleY=l,p.x=(580-580*l)/2,p.y=(480-d*l)/2+20}}return __extends(e,t),e.prototype.moveIn=function(t){void 0===t&&(t=!0);var e=t?-640:640,i=new Array;this.alpha=0,i.push(createjs.Tween.get(this).to({alpha:1},300)),this.questionText.x=this.questionText.x+e,i.push(createjs.Tween.get(this.questionText).to({x:this.questionText.x-e},1e3,this.easingMethod));for(var s=0;s<this.options.length;++s)this.options[s].x=this.options[s].x+e,i.push(createjs.Tween.get(this.options[s]).wait(200+50*s).to({x:this.options[s].x-e},800,this.easingMethod));new createjs.Timeline(i,{},{paused:!1})},e.prototype.moveOut=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!0);var i=t?640:-640,s=new Array;this.alpha=1,s.push(createjs.Tween.get(this).to({alpha:0},500)),s.push(createjs.Tween.get(this.questionText).to({x:this.questionText.x+i},700,this.easingMethod));for(var h=0;h<this.options.length;++h)this.options[h].x=this.options[h].x,s.push(createjs.Tween.get(this.options[h]).wait(100+50*h).to({x:this.options[h].x+i},500,this.easingMethod));s.push(createjs.Tween.get(this).wait(Math.max(700,600+50*this.options.length)).call(this.parent.removeChild,[this],this.parent));new createjs.Timeline(s,{},{paused:!1})},e}(createjs.Container),App=function(){function t(){this.AppName="SOCY215Traner",this.AppWidth=640,this.AppHeight=640}return t.prototype.loadJSON=function(t,e){var i=new XMLHttpRequest;i.overrideMimeType("application/json"),i.open("GET",t,!0),i.onreadystatechange=function(){4==i.readyState&&200==i.status&&e(i.responseText)},i.send(null)},t.prototype.updateViewport=function(){var t=this.stage.canvas;t.width=window.innerWidth,t.height=window.innerHeight;var e=Math.min(t.width/this.AppWidth,t.height/this.AppHeight);this.clipShape.scaleX=this.clipShape.scaleY=this.AppContainer.scaleX=this.AppContainer.scaleY=e,this.clipShape.x=this.AppContainer.x=(t.width-this.AppWidth*e)/2,this.clipShape.y=this.AppContainer.y=(t.height-this.AppHeight*e)/2,this.stage.update()},t.prototype.run=function(){this.stage=new createjs.Stage(document.getElementById("mainCanvas")),this.stage.enableMouseOver(20),createjs.Touch.enable(this.stage),this.AppContainer=new createjs.Container,this.AppContainer.setBounds(0,0,this.AppWidth,this.AppHeight),this.stage.addChild(this.AppContainer),this.clipShape=new createjs.Shape,this.clipShape.graphics.beginFill("#ffffff").drawRect(0,0,this.AppWidth,this.AppHeight),this.AppContainer.mask=this.clipShape,this.questionBoardContainer=new createjs.Container,this.AppContainer.addChild(this.questionBoardContainer),createjs.Ticker.setFPS(60),createjs.Ticker.addEventListener("tick",this.stage);var t=this;window.addEventListener("resize",function(){t.updateViewport()}),this.updateViewport(),this.showWarning(function(){t.loadingText=new createjs.Text("資料加載中...","12px Arial","#7f7f7f"),t.loadingText.x=t.AppWidth/2-t.loadingText.getMeasuredWidth()/2,t.loadingText.y=t.AppHeight/2-t.loadingText.getMeasuredHeight()/2,t.loadingText.alpha=0,createjs.Tween.get(t.loadingText).to({alpha:1},500),t.AppContainer.addChild(t.loadingText),t.loadJSON("./questions.json",function(e){createjs.Tween.get(t.loadingText,{override:!0}).to({alpha:0},300).call(t.stage.removeChild,[t.loadingText],t.stage),t.Questions=JSON.parse(e);for(var i=new Array,s=0,h=t.Questions;s<h.length;s++){var n=h[s];-1==i.indexOf(n.chapter)&&i.push(n.chapter)}t.chapterCount=i.length,t.createInterface(),t.loadSettings(),t.filterQuestions(),t.showQuestion(0)})})},t.prototype.showWarning=function(t){var e="· 開發本程序意在提供一個快速瞭解SOCY215題目套路和課程知識的訓練平台。\n· 本程序的所使用的題庫並不是最終考試所使用的題庫。\n· 直接死記本題庫並不是一個好方法。\n· 本程序只供學習之用，嚴禁用於其他用途。\n· 因本程序造成的任何後果請自行負責。\n\n任何問題：unhank8@gmail.com",i=new createjs.Container;this.AppContainer.addChild(i);var s=new createjs.Shape;s.graphics.beginFill("rgba(0, 0, 0, 0.5)").drawRect(0,0,this.AppWidth,this.AppHeight),i.addChild(s);var h=new createjs.Container;i.addChild(h);var n=new createjs.Shape;h.addChild(n);var a=new createjs.Text(e,"bold 16px Arial","#000000"),r=a.getBounds();a.x=this.AppWidth/2-r.width/2,a.y=this.AppHeight/2-r.height/2-25,h.addChild(a),n.graphics.beginFill("#efefef").drawRoundRect(0,0,r.width+40,r.height+100,20),n.x=this.AppWidth/2-(r.width+40)/2,n.y=this.AppHeight/2-(r.height+100)/2;var o=new UIButton("可以",20,130,35);o.x=this.AppWidth/2-160,o.y=this.AppHeight/2+(r.height+100)/2-55,h.addChild(o);var c=new UIButton("唔可以",20,130,35);c.x=this.AppWidth/2+30,c.y=this.AppHeight/2+(r.height+100)/2-55,h.addChild(c),c.addEventListener("click",function(){createjs.Tween.get(h,{override:!0}).to({x:30},50,createjs.Ease.cubicOut).to({x:0},50,createjs.Ease.cubicOut).to({x:-30},50,createjs.Ease.cubicOut).to({x:0},50,createjs.Ease.cubicOut).to({x:30},50,createjs.Ease.cubicOut).to({x:0},50,createjs.Ease.cubicOut).to({x:-30},50,createjs.Ease.cubicOut).to({x:0},50,createjs.Ease.cubicOut)}),o.addEventListener("click",function(){t(),createjs.Tween.get(i,{override:!0}).to({alpha:0},300).call(function(){i.parent.removeChild(i)})}),i.alpha=0,createjs.Tween.get(i).to({alpha:1},500)},t.prototype.createInterface=function(){var t=new createjs.Shape;t.graphics.beginFill("#7f7f7f").drawRoundRect(0,0,150,30,4),t.x=15,t.y=15,this.AppContainer.addChild(t),this.txtTotalQuestion=new createjs.Text("題目：100 / 100","bold 18px Arial","#000000"),this.txtTotalQuestion.textAlign="center",this.txtTotalQuestion.x=t.x+75,this.txtTotalQuestion.y=t.y+15-this.txtTotalQuestion.getMeasuredHeight()/2,this.AppContainer.addChild(this.txtTotalQuestion),this.btnSetting=new UIButton("設定",35,120,50),this.btnSetting.x=30,this.btnSetting.y=560,this.AppContainer.addChild(this.btnSetting),this.btnNextQus=new UIButton("下一題",35,160,50),this.btnNextQus.x=450,this.btnNextQus.y=560,this.AppContainer.addChild(this.btnNextQus),this.btnPrevQus=new UIButton("上一題",35,160,50),this.btnPrevQus.x=270,this.btnPrevQus.y=560,this.AppContainer.addChild(this.btnPrevQus),this.settingContainer=new createjs.Container,this.settingContainer.visible=!1;var e=new createjs.Shape;e.graphics.beginFill("rgba(0, 0, 0, 0.5)").drawRect(0,0,this.AppWidth,this.AppHeight),this.settingContainer.addChild(e),this.AppContainer.addChild(this.settingContainer);var i=this,s=550,h=450,n=new createjs.Shape;n.graphics.beginFill("#efefef").drawRoundRect(0,0,s,h,20),n.x=this.AppWidth/2-s/2,n.y=this.AppHeight/2-h/2,this.settingContainer.addChild(n),this.btnApplySetting=new UIButton("OK",24,80,50),this.btnApplySetting.x=495,this.btnApplySetting.y=475,this.settingContainer.addChild(this.btnApplySetting),this.chkIncludeTFQus=new UICheckBox("是非題",22,150,40),this.chkIncludeTFQus.x=65,this.chkIncludeTFQus.y=120,this.chkIncludeTFQus.checked=!0,this.chkIncludeTFQus.addEventListener("click",function(){i.filterQuestions()}),this.settingContainer.addChild(this.chkIncludeTFQus),this.chkIncludeMCQus=new UICheckBox("選擇題",22,150,40),this.chkIncludeMCQus.x=65,this.chkIncludeMCQus.y=180,this.chkIncludeMCQus.checked=!0,this.chkIncludeMCQus.addEventListener("click",function(){i.filterQuestions()}),this.settingContainer.addChild(this.chkIncludeMCQus),this.chkRandom=new UICheckBox("隨機出題",22,150,40),this.chkRandom.x=65,this.chkRandom.y=240,this.settingContainer.addChild(this.chkRandom),this.chkChapters=new Array;for(var a=0;a<this.chapterCount;++a){var r=new UICheckBox("Chapter "+(a+1),22,150,40);r.addEventListener("click",function(){i.filterQuestions()}),r.checked=!0,r.x=245,a>5&&(r.x+=180),r.y=120+60*a,a>5&&(r.y-=360),this.settingContainer.addChild(r),this.chkChapters.push(r)}this.completeMessageContainer=new createjs.Container,this.completeMessageContainer.visible=!1;var o=new createjs.Shape;o.graphics.beginFill("rgba(0, 0, 0, 0.5)").drawRect(0,0,this.AppWidth,this.AppHeight),this.completeMessageContainer.addChild(o),this.AppContainer.addChild(this.completeMessageContainer);var n=new createjs.Shape;n.graphics.beginFill("#efefef").drawRoundRect(0,0,400,170,20),n.x=this.AppWidth/2-200,n.y=this.AppHeight/2-85,this.completeMessageContainer.addChild(n);var c=new createjs.Text("你已經做完所有題目!","bold 32px Arial","#000000");c.x=this.AppWidth/2-c.getMeasuredWidth()/2,c.y=265,this.completeMessageContainer.addChild(c),this.btnAnswerAgain=new UIButton("朕知道",28,130,50),this.btnAnswerAgain.x=this.AppWidth/2-this.btnAnswerAgain.buttonWidth/2,this.btnAnswerAgain.y=330,this.completeMessageContainer.addChild(this.btnAnswerAgain);var i=this;this.btnSetting.addEventListener("click",function(t){i.settingContainer.visible=!0,i.settingContainer.alpha=0,createjs.Tween.get(i.settingContainer,{override:!0}).to({alpha:1},150)}),this.btnApplySetting.addEventListener("click",function(t){i.saveSettings(),i.filterQuestions(),i.chkRandom.checked?i.showQuestion(i.filteredQustions.indexOf(i.shuffledFilteredQustions[i.currentIndex])):i.showQuestion(i.currentIndex),i.settingContainer.alpha=1,createjs.Tween.get(i.settingContainer,{override:!0}).to({alpha:0},150).call(function(){i.settingContainer.visible=!1})}),this.btnAnswerAgain.addEventListener("click",function(t){i.completeMessageContainer.alpha=1,createjs.Tween.get(i.completeMessageContainer,{override:!0}).to({alpha:0},150).call(function(){i.completeMessageContainer.visible=!1,i.currentIndex=0,i.chkRandom.checked?i.showQuestion(i.filteredQustions.indexOf(i.shuffledFilteredQustions[i.currentIndex])):i.showQuestion(i.currentIndex)})}),this.btnNextQus.addEventListener("click",function(){i.nextQuestion()}),this.btnPrevQus.addEventListener("click",function(){i.prevQuestion()})},t.prototype.filterQuestions=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var i=this;if(this.filteredQustions=this.Questions.filter(function(t,e,s){for(var h=!1,n=0;n<i.chapterCount;++n)if(i.chkChapters[n].checked&&t.chapter==n+1){h=!0;break}return h?0==t.type&&i.chkIncludeTFQus.checked?!0:1==t.type&&i.chkIncludeMCQus.checked?!0:!1:!1}),this.currentIndex=0,this.txtTotalQuestion.text="題目：1 / "+this.filteredQustions.length,this.chkRandom.checked){var s=this.filteredQustions.slice();for(this.shuffledFilteredQustions=[];s.length>0;)this.shuffledFilteredQustions.push(s.splice(Math.round(Math.random()*(s.length-1)),1)[0])}else this.shuffledFilteredQustions=null},t.prototype.prevQuestion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];0!=this.filteredQustions.length&&(0==this.currentIndex?this.currentIndex=this.filteredQustions.length-1:this.currentIndex--,this.chkRandom.checked?this.showQuestion(this.filteredQustions.indexOf(this.shuffledFilteredQustions[this.currentIndex]),!0):this.showQuestion(this.currentIndex,!0))},t.prototype.nextQuestion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return 0!=this.filteredQustions.length?(this.currentIndex++,this.currentIndex==this.filteredQustions.length?(this.completeMessageContainer.visible=!0,this.completeMessageContainer.alpha=0,void createjs.Tween.get(this.completeMessageContainer).to({alpha:1},150)):void(this.chkRandom.checked?this.showQuestion(this.filteredQustions.indexOf(this.shuffledFilteredQustions[this.currentIndex])):this.showQuestion(this.currentIndex))):void 0},t.prototype.showQuestion=function(t,e){void 0===e&&(e=!1),null!=this.filteredQustions[t]&&(this.currentQuestion&&this.currentQuestion.moveOut(!e),this.currentQuestion=new QuestionBoard(this.filteredQustions[t]),this.currentQuestion.moveIn(!e),this.questionBoardContainer.addChild(this.currentQuestion),this.txtTotalQuestion.text="題目："+(t+1)+" / "+this.filteredQustions.length)},t.prototype.loadSettings=function(){var t=JSON.parse(localStorage.getItem(this.AppName));if(null!=t&&null!=t.data.tf){this.chkIncludeTFQus.checked=t.data.tf,this.chkIncludeMCQus.checked=t.data.mc,this.chkRandom.checked=t.data.random;for(var e=0;e<this.chapterCount;++e)this.chkChapters[e].checked=t.data.chapter[e]}},t.prototype.saveSettings=function(){var t=new Object;t.data={},t.data.tf=this.chkIncludeTFQus.checked,t.data.mc=this.chkIncludeMCQus.checked,t.data.random=this.chkRandom.checked;for(var e=new Array,i=0,s=this.chkChapters;i<s.length;i++){var h=s[i];e.push(h.checked)}t.data.chapter=e,localStorage.setItem(this.AppName,JSON.stringify(t))},t}();